<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <!-- Giữ nguyên fix: Khóa phóng to thu nhỏ trên mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xin Xăm Đầu Năm</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@400;700&family=Mulish:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --red-tet: #b30000;
            --red-bright: #e60000;
            --gold: #ffcc00;
            --gold-dark: #d4a000;
            --paper: #fdfbf7;
            --wood-dark: #3e2723;
            --wood-medium: #5d4037;
            --wood-light: #8d6e63;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Mulish', sans-serif;
            background-color: var(--red-tet);
            background-image: radial-gradient(circle at 50% 50%, #800000 10%, #500000 90%);
            color: #333;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            touch-action: none;
        }

        .bg-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, rgba(255, 204, 0, 0.05) 25%, transparent 25%), 
                linear-gradient(-45deg, rgba(255, 204, 0, 0.05) 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, rgba(255, 204, 0, 0.05) 75%), 
                linear-gradient(-45deg, transparent 75%, rgba(255, 204, 0, 0.05) 75%);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 1;
        }

        .flower {
            position: absolute;
            width: 80px;
            height: 80px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="petalGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="0%" style="stop-color:%23FFEB3B;stop-opacity:1" /><stop offset="100%" style="stop-color:%23FFC107;stop-opacity:1" /></radialGradient></defs><g fill="url(%23petalGrad)"><path d="M50 50 C30 40 20 20 50 10 C80 20 70 40 50 50 Z" /><path d="M50 50 C30 40 20 20 50 10 C80 20 70 40 50 50 Z" transform="rotate(72 50 50)" /><path d="M50 50 C30 40 20 20 50 10 C80 20 70 40 50 50 Z" transform="rotate(144 50 50)" /><path d="M50 50 C30 40 20 20 50 10 C80 20 70 40 50 50 Z" transform="rotate(216 50 50)" /><path d="M50 50 C30 40 20 20 50 10 C80 20 70 40 50 50 Z" transform="rotate(288 50 50)" /></g><circle cx="50" cy="50" r="7" fill="%23FF5722"/><circle cx="50" cy="50" r="4" fill="%23BF360C"/></svg>') no-repeat center/contain;
            z-index: 2;
            opacity: 0.9;
            animation: float 6s ease-in-out infinite;
        }

        .f1 { top: 20px; left: 20px; animation-delay: 0s; }
        .f2 { bottom: 20px; right: 20px; animation-delay: 2s; }
        .f3 { top: 50%; left: 10%; transform: scale(0.6); animation-delay: 1s; opacity: 0.5; }
        .f4 { top: 20%; right: 10%; transform: scale(0.8); animation-delay: 3s; opacity: 0.6; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        /* --- PHẦN MỚI: NÚT NHẠC --- */
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 200; /* Cao hơn hoa và nền, nhưng thấp hơn modal (modal là 100, cần chỉnh modal lên cao hơn nếu bị che) */
            width: 45px;
            height: 45px;
            background: rgba(179, 0, 0, 0.9);
            border: 2px solid var(--gold);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .music-control:active {
            transform: scale(0.9);
        }

        .music-control svg {
            width: 24px;
            height: 24px;
            fill: var(--gold);
        }

        /* Hiệu ứng tỏa sóng khi nhạc đang chạy */
        .music-playing {
            animation: pulse-music 2s infinite;
            border-color: #fff;
        }
        
        #audioTooltip {
            z-index: 100;
            position: absolute;
            right: 20px;
            top: 80px;
            color: white;
            background-color: #1f0301;
            padding: 14px;
            border-radius: 12px;
            display: flex;
            flex-direction: row;
            gap: 4px;
	　　opacity: 1;
            /* Animation trôi nổi */
            animation: floatHint 2s ease-in-out infinite;
        }
        #audioTooltip svg {
            fill: white;
        }

        /* Keyframes cho hiệu ứng trôi nổi của hint */
        @keyframes floatHint {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .main-container {
            z-index: 10;
            text-align: center;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            color: var(--gold);
            font-size: 3.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            line-height: 1.2;
        }

        .subtitle {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 40px;
            font-family: 'Playfair Display', serif;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        /* --- CẤU TRÚC ỐNG XĂM MỚI (Tách Wrapper và Container) --- */
        
        /* 1. Wrapper: Chỉ chịu trách nhiệm Scale kích thước và Margin */
        .tube-wrapper {
            position: relative;
            width: 130px;
            height: 230px;
            margin: 18px auto 40px auto;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        /* 2. Container: Chịu trách nhiệm Animation Lắc và chứa nội dung 3D */
        .tube-container {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .tube-opening {
            position: absolute;
            top: -2px;
            left: 0;
            width: 95%;
            height: 40px;
            background: #281912;
            border-radius: 50%;
            z-index: 1;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
            border: 2px solid #5d4037;
        }

        .tube-body {
            position: absolute;
            top: 15px;
            left: 0;
            width: 95%;
            height: 100%;
            background: 
                repeating-linear-gradient(90deg, rgba(255,255,255,0.02) 0px, rgba(255,255,255,0.02) 1px, transparent 1px, transparent 10px),
                linear-gradient(90deg, #3e2723 0%, #5d4037 20%, #8d6e63 45%, #8d6e63 55%, #5d4037 80%, #3e2723 100%);
            border-radius: 0 0 25px 25px;
            z-index: 4;
            box-shadow: 
                0 15px 25px rgba(0,0,0,0.5),
                inset 0 10px 20px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Huy hiệu LỘC tròn */
        .label-badge {
            width: 90px;
            height: 90px;
            background-color: #b30000;
            border-radius: 50%;
            border: 3px solid var(--gold);
            display: flex;
            justify-content: center;
            align-items: center;

            /* Căn giữa tuyệt đối */
            display: flex; 
            justify-content: center; 
            align-items: center;

            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            position: relative;
        }
        
        /* Viền phụ bên trong huy hiệu */
        .label-badge::before {
            content: '';
            position: absolute;
            top: 4px; left: 4px; right: 4px; bottom: 4px;
            border: 1px dashed var(--gold);
            border-radius: 50%;
            opacity: 0.6;
        }

        .label-text {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .sticks-group {
            position: absolute;
            top: -30px; left: 10px; width: calc(100% - 40px); height: 100%;
            z-index: 2;
        }

        .stick {
            position: absolute;
            width: 14px; height: 210px;
            background: linear-gradient(90deg, #dcb36b 0%, #ffe082 40%, #dcb36b 100%);
            border-radius: 2px;
            bottom: 30px;
            box-shadow: 1px 1px 4px rgba(0,0,0,0.5);
        }

        .stick::before {
            content: ''; position: absolute; top: 40%; left: 0; width: 100%; height: 2px;
            background: rgba(139, 69, 19, 0.4);
            box-shadow: 0 1px 0 rgba(255,255,255,0.3);
        }

        .stick::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 45px;
            background: linear-gradient(90deg, #b71c1c 0%, #d32f2f 40%, #b71c1c 100%);
            border-radius: 2px 2px 0 0;
        }

        .stick:nth-child(1) { left: 10px; height: 170px; transform: rotate(-6deg); z-index: 1; }
        .stick:nth-child(2) { left: 30px; height: 185px; transform: rotate(-2deg); z-index: 3; }
        .stick:nth-child(3) { left: 50px; height: 175px; transform: rotate(3deg); z-index: 2; }
        .stick:nth-child(4) { left: 70px; height: 180px; transform: rotate(7deg); z-index: 1; }
        .stick:nth-child(5) { left: 40px; height: 165px; transform: rotate(10deg); z-index: 0; }
        .stick:nth-child(6) { left: 60px; height: 178px; transform: rotate(-8deg); z-index: 0; }
        .stick:nth-child(7) { left: 20px; height: 172px; transform: rotate(5deg); z-index: 2; }

        .result-stick {
            position: absolute;
            left: 50%;
            bottom: 50px;
            width: 20px;
            height: 250px;
            background: linear-gradient(90deg, #f4d03f 0%, #fff 40%, #f4d03f 100%);
            transform: translateX(-50%) translateY(100%);
            z-index: 3;
            border-radius: 4px;
            border: 1px solid #c7a006;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10px;
            font-weight: bold;
            color: #cc0000;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            transition: transform 0.5s ease-out;
            opacity: 0;
        }

        .shake {
            /* Animation này giờ sẽ chạy bên trong wrapper đã scale, nên không gây giật size */
            animation: shake-anim 0.5s cubic-bezier(.36,.07,.19,.97) both infinite;
        }

        @keyframes shake-anim {
            10%, 90% { transform: translate3d(-2px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(4px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0) rotate(-3deg); }
            40%, 60% { transform: translate3d(6px, 0, 0) rotate(3deg); }
        }

        .stick-fly-up {
            animation: fly-up 1s ease-out forwards;
            opacity: 1 !important;
            z-index: 100;
        }

        @keyframes fly-up {
            0% { transform: translateX(-50%) translateY(50px); }
            60% { transform: translateX(-50%) translateY(-80px); }
            80% { transform: translateX(-50%) translateY(-60px); }
            100% { transform: translateX(-50%) translateY(-200px) rotate(15deg); }
        }

        .btn-gieo {
            background: linear-gradient(to bottom, #ffcc00, #ffaa00);
            color: #990000;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-family: 'Playfair Display', serif;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #cc8800, 0 10px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            margin-top: 20px;
            touch-action: manipulation;
        }

        .btn-gieo:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #cc8800, inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-gieo::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            transform: rotate(30deg);
            animation: shine 3s infinite linear;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            20% { transform: translateX(100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }

        /* MODAL KẾT QUẢ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            backdrop-filter: blur(3px);
            touch-action: pan-y;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .paper-scroll {
            width: 90%;
            max-width: 450px;
            background-color: var(--paper);
            padding: 8px; 
            border-radius: 5px;
            box-shadow: 0 0 40px rgba(255, 204, 0, 0.25);
            position: relative;
            transform: scale(0.8) translateY(20px);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 85vh; 
            overflow-y: auto; 
            border: 1px solid #e0d0b0;
            scrollbar-width: thin;
        }

        .modal-overlay.active .paper-scroll { transform: scale(1) translateY(0); }

        .content-inner {
            position: relative;
            z-index: 1;
            text-align: center;
            border: 2px solid var(--red-tet);
            border-radius: 4px;
            padding: 20px 15px 35px 15px; 
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .paper-scroll::before {
            content: "";
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border-radius: 3px;
            pointer-events: none;
        }

        .paper-scroll::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><g fill="%23d4a000" opacity="0.05"><path d="M50 0 L100 50 L50 100 L0 50 Z"/></g></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .xam-number {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--red-tet);
            font-weight: bold;
            text-transform: uppercase;
            border-bottom: 2px solid var(--gold);
            display: inline-block;
            margin-bottom: 15px;
            padding-bottom: 5px;
        }

        .xam-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 20px;
        }

        .poem {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 1.2rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 204, 0, 0.1);
            border-radius: 8px;
        }

        .interpretation {
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #444;
            margin-bottom: 20px;
        }

        .interpretation strong {
            color: var(--red-tet);
        }

        .btn-close {
            align-self: center;
            background: transparent;
            border: 2px solid var(--red-tet);
            color: var(--red-tet);
            padding: 8px 25px;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Mulish', sans-serif;
            text-transform: uppercase;
        }

        .btn-close:hover {
            background: var(--red-tet);
            color: #fff;
        }

        /* --- RESPONSIVE MEDIA QUERIES (Cập nhật để target .tube-wrapper cho Scale) --- */

        /* PC & Laptop */
        @media (min-width: 1200px) {
            .tube-wrapper { transform: scale(1.3); margin-top: 50px; margin-bottom: 70px; }
            h1 { font-size: 5rem; }
        }

        /* Tablet Portrait */
        @media (min-width: 768px) and (max-width: 1024px) {
            .tube-wrapper { transform: scale(1.8); margin-top: 150px; margin-bottom: 180px; }
            h1 { font-size: 5.6rem; }
            .subtitle { font-size: 1.5rem; }
            
        }

        /* Mobile Portrait */
        @media (max-width: 600px) and (orientation: portrait) {
            h1 { margin-top: 20px; }
			.subtitle { font-size: 1.1rem; }
            .tube-wrapper { width: 150px; height: 230px; margin-bottom: 40px; }

            /* XỬ LÝ CHỮ LỘC MOBILE: Giảm size để không bị tràn */
            .label-badge { width: 90px; height: 90px; border-width: 2px; }
            .label-text { font-size: 2rem; padding-top: 4px; }
            .stick { width: 20px; }
        }

        /* Small Mobile */
        @media (max-width: 380px) {
            .tube-wrapper { transform: scale(0.95); margin-bottom: 30px; }
            .btn-gieo { padding: 12px 30px; min-width: 180px; font-size: 1.2rem; }
            .label-badge { width: 80px; height: 80px; }
            .label-text { font-size: 2rem; }
        }

        /* Landscape Layout */
        @media (max-height: 600px) and (orientation: landscape) {
            .main-container {
                flex-direction: row; 
                gap: 5vw;
                justify-content: center;
                padding: 10px;
                height: 100vh;
                overflow: hidden;
            }
            
            .text-header { 
                flex-shrink: 1; 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
            }
            
            .subtitle { display: initial; }
            
            h1 { 
                font-size: clamp(2rem, 10vh, 3rem); 
                margin: 0; 
                line-height: 1.2;
                white-space: nowrap;
            }
            
            .tube-wrapper { 
                margin: 0;
                transform: scale(0.85); 
                flex-shrink: 0;
            }
            
            .btn-gieo { 
                margin-top: 0; 
                font-size: 1.1rem; 
                padding: 10px 25px; 
                align-self: center;
            }

            .paper-scroll {
                max-width: 650px;
                max-height: 90vh;
            }
            .content-inner {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                padding: 15px;
                text-align: left;
                align-items: start;
            }
            .xam-number, .xam-title, .btn-close { grid-column: 1 / -1; margin-left: auto; margin-right: auto; text-align: center; }
            .xam-title { margin-bottom: 10px; font-size: 2rem; }
            .poem { margin-bottom: 0; display: flex; align-items: center; justify-content: center; height: 100%; font-size: 1.1rem;}
            .interpretation { margin-bottom: 0; font-size: 0.9rem; }
        }

        @media (max-height: 400px) and (orientation: landscape) {
            .tube-wrapper { transform: scale(0.65); }
            h1 { font-size: 1.8rem; }
            .btn-gieo { padding: 8px 15px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <!-- THÊM PHẦN TẢI NHẠC -->
    <!-- Nhạc nền không lời, vui tươi, lặp lại vô tận -->
    <audio id="bgMusic" loop>
        <!-- Link nhạc dự phòng vui tươi phong cách Á Đông -->
        <source src="https://cdn.jsdelivr.net/gh/ngngan-2003/Free-audio-for-web-app@1e4cec845a7b41e8ddf994e3008c4dd814b13d31/dancing-on-chinese-new-year-464958.mp3" type="audio/mpeg">
        Trình duyệt của bạn không hỗ trợ phát nhạc.
    </audio>

    <!-- NÚT BẬT/TẮT NHẠC -->
    <button class="music-control" id="btnMusic" onclick="toggleMusic()" aria-label="Bật/Tắt nhạc">
        <!-- Icon Loa Tắt (Mặc định ban đầu) -->
        <svg id="iconMute" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
        </svg>
        <!-- Icon Loa Bật (Ẩn lúc đầu) -->
        <svg id="iconSound" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
    </button>

    <div id="audioTooltip">
        Nhấn vào loa để phát nhạc
        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M18.6731 3.66678C18.0356 3.78024 17.1965 4.05792 15.9723 4.466L11.9723 5.79934C11.2959 6.02481 10.8487 6.17507 10.5192 6.32833C10.2072 6.47345 10.0724 6.59025 9.98595 6.71015C9.89953 6.83005 9.83138 6.99494 9.79235 7.33679C9.75113 7.69779 9.75 8.16956 9.75 8.88256V10.959L20.25 7.45895C20.2499 6.21736 20.2459 5.35983 20.1541 4.7342C20.0627 4.11097 19.906 3.88657 19.7309 3.76032C19.5557 3.63407 19.2933 3.55641 18.6731 3.66678ZM21.7402 5.99952C21.7279 5.43502 21.7003 4.93995 21.6382 4.51655C21.522 3.72389 21.2634 3.01586 20.608 2.54346C19.9525 2.07106 19.1991 2.04961 18.4103 2.18999C17.6516 2.32502 16.7078 2.63965 15.5559 3.02365L11.4584 4.38947C10.8321 4.59824 10.3027 4.77466 9.88651 4.96829C9.44407 5.17412 9.06018 5.42921 8.76908 5.83309C8.47799 6.23696 8.35738 6.68182 8.30203 7.16664C8.27376 7.41423 8.26085 7.69183 8.25495 7.99952H8.25V8.7587C8.25 8.78594 8.25 8.81336 8.25 8.84095L8.25 15.9992C7.62325 15.5285 6.8442 15.2495 6 15.2495C3.92893 15.2495 2.25 16.9285 2.25 18.9995C2.25 21.0706 3.92893 22.7495 6 22.7495C8.07107 22.7495 9.75 21.0706 9.75 18.9995V12.5401L20.25 9.04009V13.9992C19.6233 13.5285 18.8442 13.2495 18 13.2495C15.9289 13.2495 14.25 14.9285 14.25 16.9995C14.25 19.0706 15.9289 20.7495 18 20.7495C20.0711 20.7495 21.75 19.0706 21.75 16.9995V7.4881C21.75 7.45241 21.75 7.41692 21.75 7.38161V5.99952H21.7402ZM20.25 16.9995C20.25 15.7569 19.2426 14.7495 18 14.7495C16.7574 14.7495 15.75 15.7569 15.75 16.9995C15.75 18.2422 16.7574 19.2495 18 19.2495C19.2426 19.2495 20.25 18.2422 20.25 16.9995ZM8.25 18.9995C8.25 17.7569 7.24264 16.7495 6 16.7495C4.75736 16.7495 3.75 17.7569 3.75 18.9995C3.75 20.2422 4.75736 21.2495 6 21.2495C7.24264 21.2495 8.25 20.2422 8.25 18.9995Z" fill="inherit"/>
        </svg>
    </div>

    <div class="bg-pattern"></div>
    <div class="flower f1"></div>
    <div class="flower f2"></div>
    <div class="flower f3"></div>
    <div class="flower f4"></div>

    <div class="main-container">
        <div class="text-header">
            <h1>Xin Xăm</h1>
            <div class="subtitle">Gieo quẻ đầu năm - Vạn sự bình an</div>
        </div>

        <!-- Cập nhật HTML: Thêm lớp Wrapper bao bên ngoài -->
        <div class="tube-wrapper">
            <div class="tube-container" id="tubeContainer">
                <div class="tube-opening"></div>
                <div class="sticks-group">
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                </div>
                <div class="tube-body">
                    <div class="label-badge">
                        <span class="label-text">LỘC</span>
                    </div>
                </div>
                <div class="result-stick" id="resultStick">
                    <span>|||||</span>
                </div>
            </div>
        </div>

        <button class="btn-gieo" id="btnShake" onclick="shakeTube()">Lắc Ống Xăm</button>
    </div>

    <!-- MODAL KẾT QUẢ -->
    <div class="modal-overlay" id="resultModal">
        <div class="paper-scroll">
            <div class="content-inner">
                <div class="xam-number" id="xamNumber">Xăm Số 01</div>
                <h2 class="xam-title" id="xamType">Thượng Thượng</h2>
                
                <div class="poem" id="xamPoem"></div>

                <div class="interpretation" id="xamMeaning"></div>

                <button class="btn-close" onclick="closeModal()">Nhận Lộc</button>
            </div>
        </div>
    </div>
    <script>

        // --- PHẦN MỚI: XỬ LÝ NHẠC ---
        const music = document.getElementById('bgMusic');
        const btnMusic = document.getElementById('btnMusic');
        const iconMute = document.getElementById('iconMute');
        const iconSound = document.getElementById('iconSound');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                music.pause();
                iconMute.style.display = 'block';
                iconSound.style.display = 'none';
                btnMusic.classList.remove('music-playing');
            } else {
                // Một số trình duyệt yêu cầu tương tác người dùng mới cho phát
                music.play().catch(error => {
                    console.log("Không thể tự động phát nhạc: ", error);
                });
                iconMute.style.display = 'none';
                iconSound.style.display = 'block';
                btnMusic.classList.add('music-playing');

                // hide tooltip
                const tooltip = document.getElementById('audioTooltip');
                tooltip.style.display = 'none';
            }
            isMusicPlaying = !isMusicPlaying;
        }
        // Dữ liệu các quẻ xăm (giữ nguyên)
        const fortunes = [
            {
                id: "01",
                type: "Đại Cát",
                poem: "Xuân sang cảnh sắc thật huy hoàng<br>Trăm hoa đua nở đón nắng vàng<br>Người người nô nức vui đón Tết<br>Lộc phúc đầy nhà, thọ tỷ nam.",
                meaning: {
                    home: "Gia đình hạnh phúc, con cháu sum vầy hiếu thảo.",
                    work: "Công việc thuận buồm xuôi gió, kinh doanh phát đạt.",
                    love: "Tình cảm mặn nồng, hỷ sự đến gần.",
                    advice: "Quẻ rất tốt. Hãy tận dụng thời cơ để phát triển bản thân và giúp đỡ mọi người."
                }
            },
            {
                id: "02",
                type: "Thượng Kiết",
                poem: "Mây tan mưa tạnh trời quang đãng<br>Trăng thanh gió mát dạ thênh thang<br>Việc cũ qua rồi đừng luyến tiếc<br>Tương lai rạng rỡ bước huy hoàng.",
                meaning: {
                    home: "Mọi hiểu lầm được hóa giải, trong ấm ngoài êm.",
                    work: "Khó khăn qua đi, bắt đầu giai đoạn tăng trưởng mới.",
                    love: "Gặp được người tâm đầu ý hợp sau bao ngày chờ đợi.",
                    advice: "Kiên nhẫn là chìa khóa. Sau cơn mưa trời lại sáng."
                }
            },
            {
                id: "03",
                type: "Trung Bình",
                poem: "Đường đi gập ghềnh chớ vội vàng<br>Giữ lòng kiên định dạ an khang<br>Chờ thời cơ đến ta sẽ bước<br>Thành công ắt hẳn sẽ vẻ vang.",
                meaning: {
                    home: "Bình thường, cần quan tâm sức khỏe người già.",
                    work: "Nên duy trì hiện tại, tránh đầu tư mạo hiểm.",
                    love: "Cần thấu hiểu và nhường nhịn nhau hơn.",
                    advice: "Dục tốc bất đạt. Năm nay nên lấy tĩnh chế động, trau dồi nội lực."
                }
            },
            {
                id: "04",
                type: "Thượng Cát",
                poem: "Cây khô nảy lộc lại ra hoa<br>Tin vui đưa đến tận cửa nhà<br>Quý nhân phương Bắc đem tài lộc<br>Vạn sự hanh thông khúc khải ca.",
                meaning: {
                    home: "Có tin vui về thêm người hoặc thêm của.",
                    work: "Được cấp trên tin tưởng, đồng nghiệp quý mến.",
                    love: "Duyên lành tự đến, hạnh phúc viên mãn.",
                    advice: "Thời vận đang lên, mạnh dạn thực hiện những dự định ấp ủ."
                }
            },
            {
                id: "05",
                type: "Hạ Hạ (Cẩn Trọng)",
                poem: "Thuyền đi ngược gió nước mênh mông<br>Lèo lái khéo tay kẻo uổng công<br>Giữ mình tu đức chờ vận mới<br>Bĩ cực qua rồi tới thái lai.",
                meaning: {
                    home: "Đề phòng lời qua tiếng lại, nên nhẫn nhịn.",
                    work: "Có chút trắc trở, cẩn thận lời lẽ thị phi.",
                    love: "Tránh ghen tuông vô cớ làm rạn nứt tình cảm.",
                    advice: "Năm nay nên an phận thủ thường, làm nhiều việc thiện để giải hạn."
                }
            },
            {
                id: "06",
                type: "Thượng Thượng",
                poem: "Rồng bay phượng múa giữa trời cao<br>Tài lộc công danh tựa sóng trào<br>Cầu được ước thấy lòng phơi phới<br>Phúc đức tổ tiên thật dạt dào.",
                meaning: {
                    home: "An khang thịnh vượng, vạn sự như ý.",
                    work: "Thăng quan tiến chức, buôn bán một vốn bốn lời.",
                    love: "Hôn nhân bền vững, hạnh phúc viên mãn.",
                    advice: "Phước lộc dồi dào, nhớ chia sẻ và giúp đỡ người khó khăn."
                }
            },
            {
                id: "07",
                type: "Trung Cát",
                poem: "Ngọc ẩn trong đá đợi người mài<br>Tài năng rèn luyện có ngày thành công<br>Đừng nên khó nản lòng<br>Thành công rực rỡ đang chờ ngày mai.",
                meaning: {
                    home: "Ổn định, cần dành thời gian chăm sóc gia đình.",
                    work: "Nỗ lực sẽ được đền đáp xứng đáng vào cuối năm.",
                    love: "Cần chủ động hơn trong tình cảm.",
                    advice: "Cần cù bù thông minh. Sự nỗ lực sẽ quyết định vận may."
                }
            },
            {
                id: "08",
                type: "Thượng Kiết",
                poem: "Cá chép vượt vũ môn hóa rồng<br>Chí lớn bao năm thỏa ước mong<br>Bốn phương hội tụ về chung sức<br>Sự nghiệp từ nay rạng sắc hồng.",
                meaning: {
                    home: "Vinh hiển, rạng danh dòng tộc.",
                    work: "Thi cử đỗ đạt, sự nghiệp thăng tiến vượt bậc.",
                    love: "Đón hỷ sự. Được gia đình hai bên ủng hộ nhiệt tình.",
                    advice: "Cơ hội chuyển mình đã đến. Hãy biết nắm bắt."
                }
            },
             {
                id: "09",
                type: "Bình Hòa",
                poem: "Nước chảy bèo trôi cứ thong dong<br>Chuyện đời được mất chớ bận lòng<br>Tâm an vạn sự đều yên ổn<br>Hạnh phúc đơn sơ tại tấm lòng.",
                meaning: {
                    home: "Yên ả, không có biến cố lớn.",
                    work: "Công việc ổn định, thu nhập đủ chi tiêu.",
                    love: "Tình cảm nhẹ nhàng, bình lặng.",
                    advice: "Biết đủ là hạnh phúc. Sống chậm lại để cảm nhận cuộc sống."
                }
            },
            {
                id: "10",
                type: "Đại Cát",
                poem: "Mặt trời rực rỡ chiếu phương Đông<br>Tan hết sương mù sắc thắm nồng<br>Người đi xa xứ nay về lại<br>Sum họp một nhà thỏa nhớ mong.",
                meaning: {
                    home: "Đoàn tụ viên mãn, tiếng cười ngập tràn.",
                    work: "Mở rộng quy mô, hợp tác thành công.",
                    love: "Gương vỡ lại lành, tình cảm thăng hoa.",
                    advice: "Vận khí cực thịnh. Hãy thực hiện những kế hoạch lớn."
                }
            },
            {
                id: "11", type: "Thượng Cát",
                poem: "Đầu năm hái lộc ở chùa xa<br>Phật độ bình an đến mọi nhà<br>Tâm thiện việc lành năng tích đức<br>Vinh hoa phú quý tựa gấm hoa.",
                meaning: { home: "Được ơn trên che chở, bình an.", work: "Gặp may mắn bất ngờ.", love: "Duyên đẹp do trời định.", advice: "Năng đi chùa, làm việc thiện để tăng phước." }
            },
            {
                id: "12", type: "Trung Kiết",
                poem: "Chim én liệng bay báo xuân về<br>Ruộng vườn tươi tốt rạng hồn quê<br>Cày sâu cuốc bẫm chờ ngày gặt<br>Thóc lúa đầy kho sướng mọi bề.",
                meaning: { home: "Sung túc, ấm no.", work: "Kết quả tốt từ sự chăm chỉ.", love: "Lòng chân thành sẽ được hồi đáp.", advice: "Hãy kiên trì, thành quả đang đến gần." }
            },
            {
                id: "13", type: "Đại Cát",
                poem: "Thuyền rồng lướt sóng ra khơi xa<br>Chở đầy châu báu trở về nhà<br>Công thành danh toại người ngưỡng mộ<br>Hạnh phúc tràn trề khúc khải ca.",
                meaning: { home: "Tài lộc vào như nước.", work: "Dự án lớn thành công rực rỡ.", love: "Viên mãn, hạnh phúc ngập tràn.", advice: "Thời cơ vàng để mở rộng kinh doanh." }
            },
            {
                id: "14", type: "Thượng Bình",
                poem: "Quý nhân phù trợ bước đường đi<br>Gặp dữ hóa lành chẳng ngại chi<br>Tâm sáng như gương soi vạn vật<br>An nhiên vui vẻ chớ ưu phiền.",
                meaning: { home: "Gặp dữ hóa lành, mọi sự bình an.", work: "Được người trên nâng đỡ.", love: "Tình cảm bền chặt.", advice: "Luôn giữ tâm thế lạc quan." }
            },
            {
                id: "15", type: "Trung Bình",
                poem: "Bình an vô sự tháng ngày qua<br>Không tranh không đoạt giữ nếp nhà<br>Tâm tịnh lòng an đời thanh thản<br>Hạnh phúc đơn sơ tựa bài ca.",
                meaning: { home: "Êm ấm, không sóng gió.", work: "Ổn định, không áp lực.", love: "Nhẹ nhàng, bình yên.", advice: "Hạnh phúc đến từ sự bình yên trong tâm hồn." }
            },
            {
                id: "16", type: "Thượng Kiết",
                poem: "Tình duyên nở rộ thắm màu hoa<br>Hạnh phúc đong đầy khắp mọi nhà<br>Chung sức chung lòng xây tổ ấm<br>Tương lai rạng rỡ khúc hoan ca.",
                meaning: { home: "Hòa thuận, yêu thương.", work: "Đồng nghiệp hỗ trợ hết mình.", love: "Tìm được ý trung nhân.", advice: "Năm tốt cho việc phát triển sự nghiệp." }
            },
            {
                id: "17", type: "Đại Cát",
                poem: "Mua may bán đắt lộc đầy kho<br>Tiền vô như nước chẳng phải lo<br>Cơ hội làm ăn đang rộng mở<br>Phất cờ khởi nghiệp thật to to.",
                meaning: { home: "Kinh tế dư dả.", work: "Kinh doanh phát đạt.", love: "Có điều kiện chăm lo gia đình.", advice: "Mạnh dạn đầu tư, mở rộng kinh doanh." }
            },
            {
                id: "18", type: "Trung Cát",
                poem: "Sức khỏe dồi dào tựa thái sơn<br>Bệnh tật tiêu tan hết giận hờn<br>Tinh thần phấn chấn làm việc tốt<br>Cuộc đời tươi đẹp vạn lần hơn.",
                meaning: { home: "Mọi người đều khỏe mạnh.", work: "Năng lượng dồi dào.", love: "Vui vẻ, tích cực.", advice: "Sức khỏe là vốn quý nhất, hãy trân trọng." }
            },
            {
                id: "19", type: "Bình Hòa",
                poem: "Cuộc sống êm đềm tựa dòng sông<br>Không lo phiền muộn, chẳng bão giông<br>Thảnh thơi tận hưởng ngày vui vẻ<br>An nhiên tự tại thỏa ước mong.",
                meaning: { home: "Bình yên, thư thái.", work: "Không có áp lực lớn.", love: "Ổn định, lâu dài.", advice: "Sống chậm lại để cảm nhận cuộc sống." }
            },
            {
                id: "20", type: "Thượng Thượng",
                poem: "Con cháu thảo hiền phúc lộc tăng<br>Gia đạo hưng long tựa ánh trăng<br>Tiếng cười rộn rã vui như hội<br>Vạn sự an khang, phước vĩnh hằng.",
                meaning: { home: "Con cháu ngoan ngoãn, thành đạt.", work: "Hậu vận tốt đẹp.", love: "Gia đình là chỗ dựa vững chắc.", advice: "Gia hòa vạn sự hưng." }
            },
            {
                id: "21", type: "Trung Kiết",
                poem: "Học hành tấn tới rạng công danh<br>Thi cử đỗ đạt mộng ước thành<br>Kiến thức trau dồi thêm vững chắc<br>Tương lai rộng mở bước nhanh nhanh.",
                meaning: { home: "Con cái học giỏi.", work: "Thăng tiến nhờ năng lực.", love: "Tình cảm hạnh phúc.", advice: "Đầu tư cho tri thức là đầu tư khôn ngoan." }
            },
            {
                id: "22", type: "Đại Cát",
                poem: "Đi xa gặp được quý nhân<br>Trở về vinh hiển, xóa tan mây mù<br>Công danh sự nghiệp rạng ngời<br>Yên vui hạnh phúc bên người mình thương.",
                meaning: { home: "Có người đi xa về thăm.", work: "Cơ hội công tác, du học.", love: "Duyên nợ phương xa.", advice: "Mạnh dạn bước ra khỏi vùng an toàn." }
            },
            {
                id: "23", type: "Thượng Cát",
                poem: "Trồng cây hái quả lúc xuân sang<br>Mùa màng bội thu lúa đầy làng<br>Công sức bỏ ra nay đền đáp<br>Gia đình no ấm, thật bình an.",
                meaning: { home: "Tài sản gia tăng.", work: "Gặt hái thành quả.", love: "Tình cảm chín muồi.", advice: "Không có nỗ lực nào là vô ích." }
            },
            {
                id: "24", type: "Trung Bình",
                poem: "Giữ vững tâm trí trước phong ba<br>Kiên trì nhẫn nại ắt vượt qua<br>Khó khăn chỉ là cơn gió thoảng<br>Sau cơn mưa bão nắng chan hòa.",
                meaning: { home: "Cần sự đoàn kết.", work: "Kiên trì sẽ thành công.", love: "Cùng nhau vượt qua thử thách.", advice: "Lửa thử vàng, gian nan thử sức." }
            },
            {
                id: "25", type: "Thượng Kiết",
                poem: "Bạn bè giúp đỡ lúc gian nan<br>Tình nghĩa keo sơn thật chứa chan<br>Hợp tác cùng nhau làm việc lớn<br>Thành công rực rỡ, tiếng vang vang.",
                meaning: { home: "Có khách quý đến thăm.", work: "Hợp tác thành công.", love: "Bạn đời là tri kỷ.", advice: "Muốn đi xa hãy đi cùng nhau." }
            },
            {
                id: "26", type: "Đại Cát",
                poem: "Cầu được ước thấy vạn sự hay<br>Sở cầu như ý phúc tràn đầy<br>Vận may gõ cửa đừng bỏ lỡ<br>Nắm bắt thời cơ phất ngay tay.",
                meaning: { home: "Mọi mong ước đều thành.", work: "Thuận lợi mọi bề.", love: "Hạnh phúc viên mãn.", advice: "Hãy tự tin thực hiện ước mơ." }
            },
            {
                id: "27", type: "Bình Hòa",
                poem: "Biết đủ là vui sống thảnh thơi<br>Hạnh phúc tại tâm chớ xa vời<br>Không tham danh lợi, không sầu não<br>An lạc mỗi ngày, nụ cười tươi.",
                meaning: { home: "Giản dị mà đầm ấm.", work: "Biết điểm dừng đúng lúc.", love: "Chân thành, mộc mạc.", advice: "Tâm an vạn sự an." }
            },
            {
                id: "28", type: "Hạ Trung",
                poem: "Phương xa tin tức vẫn chưa về<br>Mây xám giăng giăng lối sơn khê<br>Chớ vội mong cầu điều huyễn hoặc<br>Tĩnh tâm chờ đợi, bớt bộn bề.",
                meaning: { home: "Không khí trầm lắng, có bất đồng nhỏ nhưng không đáng ngại.", work: "Kế hoạch bị trì hoãn, kết quả chưa đến ngay.", love: "Có khoảng cách hoặc chưa thấu hiểu nhau.", advice: "Thời vận đang chững lại. Thay vì cố gắng cưỡng cầu, hãy dành thời gian nghỉ ngơi và củng cố nội lực." }
            },
            {
                id: "29", type: "Trung Kiết",
                poem: "Việc cũ thành công, việc mới hay<br>Thuận buồm xuôi gió vận may này<br>Mở mang kiến thức thêm tài nghệ<br>Vững bước tương lai, dựng mộng say.",
                meaning: { home: "Tiếp nối truyền thống tốt.", work: "Khởi đầu mới suôn sẻ.", love: "Tình cảm ngày càng sâu sắc.", advice: "Học hỏi cái mới, phát huy cái cũ." }
            },
            {
                id: "30", type: "Thượng Thượng",
                poem: "Phúc lộc thọ khang đến mọi nhà<br>Vạn sự viên mãn tựa ngàn hoa<br>Cuộc đời tươi đẹp như tranh vẽ<br>Hạnh phúc trường tồn, khúc hoan ca.",
                meaning: { home: "Viên mãn trọn vẹn.", work: "Đỉnh cao sự nghiệp.", love: "Hạnh phúc mỹ mãn.", advice: "Vạn sự hoàn hảo, hãy biết tận hưởng cuộc sống." }
            }
        ];

        let isShaking = false;
        const tube = document.getElementById('tubeContainer');
        const btn = document.getElementById('btnShake');
        const resultStick = document.getElementById('resultStick');
        const modal = document.getElementById('resultModal');

        function vibrateDevice() {
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100]);
            }
        }

        function shakeTube() {
            if (isShaking) return;
            isShaking = true;
            btn.disabled = true;
            btn.textContent = "Đang lắc...";

            tube.classList.add('shake');
            vibrateDevice();

            const shakeTime = 1500 + Math.random() * 1000;

            setTimeout(() => {
                tube.classList.remove('shake');
                
                const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
                
                showStickResult(randomFortune);
            }, shakeTime);
        }

        function showStickResult(fortune) {
            resultStick.style.animation = 'none';
            resultStick.offsetHeight; 
            resultStick.style.animation = null; 
            
            resultStick.classList.add('stick-fly-up');

            setTimeout(() => {
                fillModalData(fortune);
                modal.classList.add('active');
                
                setTimeout(() => {
                    resultStick.classList.remove('stick-fly-up');
                    isShaking = false;
                    btn.disabled = false;
                    btn.textContent = "Lắc Ống Xăm";
                }, 500);
            }, 1000);
        }

        function fillModalData(data) {
            document.getElementById('xamNumber').textContent = "Xăm Số " + data.id;
            document.getElementById('xamType').textContent = data.type;
            document.getElementById('xamPoem').innerHTML = data.poem;
            
            const meaningHtml = `
                <p><strong>• Gia đạo:</strong> ${data.meaning.home}</p>
                <p><strong>• Công danh:</strong> ${data.meaning.work}</p>
                <p><strong>• Tình duyên:</strong> ${data.meaning.love}</p>
                <p><strong>• Lời bàn:</strong> ${data.meaning.advice}</p>
            `;
            document.getElementById('xamMeaning').innerHTML = meaningHtml;
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
    </script>
</body>
</html>
